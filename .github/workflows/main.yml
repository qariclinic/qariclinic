name: Flutter Complete CI

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.13.0'
        
    - name: Analyze Project Structure
      run: |
        echo "=== Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ú©ÛŒ Ù…Ú©Ù…Ù„ structure ==="
        find . -type f -name "*.dart" -o -name "*.yaml" -o -name "*.html" | head -20
        echo "=== Ù…ÙˆØ¬ÙˆØ¯Û ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹Ø±ÛŒ ==="
        ls -la
        echo "=== lib ÙÙˆÙ„ÚˆØ± ==="
        ls -la lib/ || echo "lib ÙÙˆÙ„ÚˆØ± Ù†ÛÛŒÚº ÛÛ’"
        echo "=== web ÙÙˆÙ„ÚˆØ± ==="
        ls -la web/ || echo "web ÙÙˆÙ„ÚˆØ± Ù†ÛÛŒÚº ÛÛ’"
        
    - name: Fix All Missing Files
      run: |
        echo "=== ØªÙ…Ø§Ù… missing ÙØ§Ø¦Ù„Ø² Ú©Ùˆ fix Ú©Ø± Ø±ÛØ§ ÛÙˆÚº ==="
        
        # 1. pubspec.yaml Ú©Ùˆ fix Ú©Ø±ÛŒÚº
        if [ ! -f "pubspec.yaml" ] || ! grep -q "environment:" pubspec.yaml; then
          echo "ðŸ”§ pubspec.yaml Ú©Ùˆ fix Ú©Ø± Ø±ÛØ§ ÛÙˆÚº..."
          cat > pubspec.yaml << 'PUBSPEC'
name: flutter_admin_dashboard
description: A Complete Flutter Admin Dashboard
publish_to: 'none'
version: 1.0.0+1

environment:
  sdk: '>=3.1.0 <4.0.0'
  flutter: '>=3.13.0'

dependencies:
  flutter:
    sdk: flutter
  flutter_svg: ^2.0.7
  google_fonts: ^4.0.4
  provider: ^6.1.1

dev_dependencies:
  flutter_test:
    sdk: flutter

flutter:
  uses-material-design: true
PUBSPEC
        fi
        
        # 2. lib/main.dart Ø¨Ù†Ø§Ø¦ÛŒÚº
        if [ ! -f "lib/main.dart" ]; then
          echo "ðŸ”§ lib/main.dart Ø¨Ù†Ø§Ø±ÛØ§ ÛÙˆÚº..."
          mkdir -p lib
          cat > lib/main.dart << 'DART'
import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Admin Dashboard',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        useMaterial3: true,
      ),
      home: const DashboardScreen(),
    );
  }
}

class DashboardScreen extends StatelessWidget {
  const DashboardScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Admin Dashboard'),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
      ),
      body: const Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(Icons.dashboard, size: 64, color: Colors.blue),
            SizedBox(height: 20),
            Text(
              'Admin Dashboard',
              style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
            ),
            SizedBox(height: 10),
            Text(
              'Application is Ready!',
              style: TextStyle(fontSize: 16, color: Colors.grey),
            ),
          ],
        ),
      ),
    );
  }
}
DART
        fi
        
        # 3. web ÙÙˆÙ„ÚˆØ± Ø¨Ù†Ø§Ø¦ÛŒÚº
        if [ ! -d "web" ]; then
          echo "ðŸ”§ web ÙÙˆÙ„ÚˆØ± Ø¨Ù†Ø§Ø±ÛØ§ ÛÙˆÚº..."
          mkdir -p web
          cat > web/index.html << 'HTML'
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="description" content="Flutter Admin Dashboard">
    
    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="admin_dashboard">
    
    <title>Admin Dashboard</title>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <script src="flutter.js" defer></script>
    <script src="main.dart.js" defer></script>
    <div id="loading">
        <style>
            #loading {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                font-family: Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                font-size: 24px;
            }
        </style>
        Loading Admin Dashboard...
    </div>
</body>
</html>
HTML

          cat > web/manifest.json << 'MANIFEST'
{
    "name": "Admin Dashboard",
    "short_name": "Dashboard",
    "start_url": ".",
    "display": "standalone",
    "background_color": "#0175C2",
    "theme_color": "#0175C2",
    "description": "A Flutter Admin Dashboard Application.",
    "orientation": "portrait-primary",
    "icons": [
        {
            "src": "icons/icon-192.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "icons/icon-512.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
}
MANIFEST
        fi
        
        echo "âœ… ØªÙ…Ø§Ù… ÙØ§Ø¦Ù„Ø² ØªÛŒØ§Ø± ÛÛŒÚº!"
        
    - name: Install Dependencies
      run: flutter pub get
      
    - name: Build Web App
      run: flutter build web --release --verbose
      
    - name: Verify Build
      run: |
        echo "=== Build Verification ==="
        ls -la build/web/
        [ -f "build/web/index.html" ] && echo "âœ… index.html Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’"
        [ -f "build/web/main.dart.js" ] && echo "âœ… main.dart.js Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’"
        echo "=== Build Size ==="
        du -sh build/web/
        
    - name: Upload Complete Build
      uses: actions/upload-artifact@v4
      with:
        name: complete-web-app
        path: build/web/
        retention-days: 30
        
    - name: Upload Source Code
      uses: actions/upload-artifact@v4
      with:
        name: source-code
        path: |
          lib/
          web/
          pubspec.yaml
        retention-days: 30
